import{EacSwiper,setGridItemsGlobalLink}from"../modules/eac-modules.js";class widgetArticlesListe extends elementorModules.frontend.handlers.Base{getDefaultSettings(){return{selectors:{targetInstance:".eac-post-grid",targetWrapper:".al-posts__wrapper",articleWrapper:".al-post__wrapper",imagesInstance:".al-post__image-loaded",targetCards:".al-post__inner-wrapper",targetSkipGrid:".eac-skip-grid",filterWrapper:".al-filters__wrapper a",filterWrapperSelect:".al-filters__select",buttonPaged:".al-more-button-paged"}}}getDefaultElements(){const e=this.getSettings("selectors");let t={$targetInstance:this.$element.find(e.targetInstance),$targetWrapper:this.$element.find(e.targetWrapper),$articleWrapper:this.$element.find(e.articleWrapper),$imagesInstance:this.$element.find(e.imagesInstance),$targetCards:this.$element.find(e.targetCards),$targetSkipGrid:this.$element.find(e.targetSkipGrid),$filterWrapper:this.$element.find(e.filterWrapper),$filterWrapperSelect:this.$element.find(e.filterWrapperSelect),$buttonPaged:this.$element.find(e.buttonPaged),settings:this.$element.find(e.targetWrapper).data("settings")||{},$targetId:null,$paginationId:null,$navigationId:null,widgetId:this.$element.data("id"),iso:null,isotopeOptions:{itemSelector:".al-post__wrapper",percentPosition:!0,masonry:{columnWidth:".al-posts__wrapper-sizer"},fitRows:{equalheight:!1},layoutMode:"fitRows",sortBy:"original-order",visibleStyle:{transform:"scale(1)",opacity:1}},infiniteScrollOptions:{path:function(){return location.pathname.replace(/\/?$/,"/")+"page/"+parseInt(this.pageIndex+1)},debug:!1,button:"",status:"",scrollThreshold:!1,history:!1,horizontalOrder:!1},has_swiper:!1};return t.$targetId=jQuery(t.settings.data_id),t.isotopeOptions.layoutMode=t.settings.data_layout,t.isotopeOptions.fitRows.equalheight="fitRows"===t.settings.data_layout,t.$paginationId=t.settings.data_pagination?jQuery(t.settings.data_pagination_id):null,t.$navigationId=t.settings.data_navigation?jQuery(t.settings.data_navigation_id):null,t.infiniteScrollOptions.button=t.settings.data_pagination_id+" button",t.infiniteScrollOptions.status=t.settings.data_pagination_id+" .al-page-load-status",t.has_swiper=t.settings.data_sw_swiper||!1,t}onInit(){super.onInit(),this.elements.has_swiper?new EacSwiper(this.elements.settings,this.elements.$targetInstance):(0!==this.elements.$imagesInstance.length&&this.elements.settings.data_lazy||this.elements.$targetId.isotope(this.elements.isotopeOptions),this.elements.settings.data_filtre&&window.setTimeout((()=>{this.setFilterWithWindowLocation()}),500),this.elements.settings.data_pagination&&!elementorFrontend.isEditMode()&&this.elements.$targetId.infiniteScroll(this.elements.infiniteScrollOptions)),elementorFrontend.isEditMode()||setGridItemsGlobalLink(this.elements.$targetCards)}bindEvents(){elementorFrontend.isEditMode()||(this.elements.settings.data_filtre&&(this.elements.$filterWrapper.on("click",(e=>{this.onFilterGridClick(e)})),this.elements.$filterWrapperSelect.on("change",(e=>{this.onFilterGridChange(e)}))),this.elements.settings.data_pagination?this.elements.$targetId.on("load.infiniteScroll",this.onLoadInfiniteScroll.bind(this)):this.elements.settings.data_navigation&&this.setAccessibilityElements(),this.elements.$targetInstance.length>0&&this.elements.$targetInstance.on("keydown",(e=>{this.setKeyboardEvents(e)}))),!this.elements.has_swiper&&this.elements.$imagesInstance.length>0&&this.elements.settings.data_lazy&&jQuery.each(this.elements.$imagesInstance,((e,t)=>{new IntersectionObserver(this.observeImageInViewport.bind(this),{threshold:.5}).observe(t)})),jQuery(".e-n-tab-title").on("click",(()=>{setTimeout((()=>{window.dispatchEvent(new Event("resize"))}),50)}))}observeImageInViewport(e,t){if(e[0].isIntersecting){const s=e[0].target;this.elements.settings.data_animate&&jQuery(s).closest("article").addClass("animate-first-load"),t.unobserve(s),this.elements.$targetId.isotope(this.elements.isotopeOptions),window.setTimeout((()=>{jQuery(s).closest("article").removeClass("animate-first-load")}),1e3)}}setFilterWithWindowLocation(){const e=this,t=window.location.search,s=new URLSearchParams(t),i=!!s.has("filter")&&decodeURIComponent(s.get("filter"));let n=0;if(i){let t=window.setInterval((function(){if(n<5){const s=jQuery(".al-filters__wrapper a[data-filter='."+i+"']",e.elements.$targetInstance),a=jQuery(".al-filters__wrapper-select .al-filters__select",e.elements.$targetInstance);1===s.length&&1===a.length?(window.clearInterval(t),t=null,s.trigger("click"),s.trigger("focus"),a.val("."+i),a.trigger("change")):n++}else window.clearInterval(t),t=null}),100)}}onFilterGridClick(e){const t=jQuery(e.currentTarget),s=t.parents(".al-filters__wrapper");e.preventDefault(),t.parents(".al-filters__item").hasClass("al-active")||(s.find(".al-active").removeClass("al-active"),t.parents(".al-filters__item").addClass("al-active"),this.elements.$targetId.isotope({filter:t.attr("data-filter")}))}onFilterGridChange(e){e.preventDefault(),this.elements.$targetId.isotope({filter:e.currentTarget.value})}onLoadInfiniteScroll(e,t,s){const i=this.elements.$targetId.data("infiniteScroll"),n="."+this.elements.settings.data_article+".al-post__wrapper",a=jQuery(t).find(n),r=a.find(".al-post__inner-wrapper"),l=a.find('button, a, [tabindex]:not([tabindex="-1"])').first();if(this.elements.$targetId.append(a).isotope("appended",a),a.imagesLoaded().progress(((e,t)=>{t.isLoaded})).always((()=>{this.elements.$targetId.isotope(this.elements.isotopeOptions),window.setTimeout((()=>{l.trigger("focus"),setGridItemsGlobalLink(r)}),200)})),parseInt(i.pageIndex)>=parseInt(this.elements.settings.data_max_pages))this.elements.$targetId.infiniteScroll("destroy"),this.elements.$paginationId.remove();else{const e=parseInt(this.elements.$buttonPaged.text().split("/")[0])+a.length+"/"+this.elements.settings.data_found_posts;this.elements.$buttonPaged.text(e)}}setKeyboardEvents(e){const t='button, a, [tabindex]:not([tabindex="-1"])',s=e.code||e.key||0;let i=null,n=null;if(this.elements.settings.data_filtre){const e=this.elements.$targetId.isotope("getFilteredItemElements");i=jQuery(e).find(t).first(),n=jQuery(e).find(t).last()}else{const e=this.elements.$targetInstance.find("article").find(t);i=e.first(),n=e.last()}if("Tab"===s&&!e.shiftKey||"Tab"===s&&e.shiftKey)return!0;"Home"===s?(e.preventDefault(),i.trigger("focus")):"End"===s?(e.preventDefault(),n.trigger("focus")):"Escape"===s&&this.elements.$targetSkipGrid.trigger("focus")}setAccessibilityElements(){const e=this.elements.$navigationId.find("a.page-numbers").not(".current").not(".dots");jQuery.each(e,((e,t)=>{jQuery(t).hasClass("next")?jQuery(t).attr("aria-label","Next page"):jQuery(t).hasClass("prev")?jQuery(t).attr("aria-label","Previous page"):jQuery(t).attr("aria-label","Page "+t.innerText)}))}}jQuery(window).on("elementor/frontend/init",(()=>{elementorFrontend.elementsHandler.attachHandler("eac-addon-articles-liste",widgetArticlesListe),elementorFrontend.elementsHandler.attachHandler("eac-addon-product-grid",widgetArticlesListe)}));